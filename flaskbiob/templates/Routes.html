{% extends "BASE.html" %}

{% block extrahead %}
<link rel="stylesheet" href="{{ url_for('static', filename='nouislider/distribute/nouislider.css') }}">
{% endblock extrahead %}


{% block content %}
    <div class="row">
        <div class="col-md-3">
            {% if filtered %}
                <a href="{{ url_for('routes.routesPage') }}" class="btn btn-dark btn-sm active" role="button" aria-pressed="true">Clear Filters</a>
            {% endif %}
            <button class="btn btn-primary btn-sm m-2" id="filter-button" onclick="toggleFilters()">
                Filters
            </button>
            <div id="collapsefilters" class="hide-me">
                <form method="POST" action="" enctype="multipart/form-data">
                {{form.hidden_tag() }}
                <fieldset class="form-group">
                    <legend class="border-bottom mb-4">
                        Sort and Filter
                    </legend>
                    <div class="form-group">
                        {{ form.region.label(class="form-control-label") }}

                        {% if form.region.errors %}
                            {{ form.region(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.region.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.region(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <div class="form-control-label">Distance</div>
                        <div class="slider-base">
                        <div id="distance-slider"></div>
                        </div>
                        <table>
                            <tr>
                                <td id="distance-slider-min"></td>
                                <td id="distance-slider-max"></td>
                            </tr>
                        </table>
                        {% if form.length_min.errors %}
                            {{ form.length_min(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.length_min.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.length_min(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {% if form.length_max.errors %}
                            {{ form.length_max(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.length_max.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.length_max(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <div class="form-control-label">Ascent</div>
                        <div class="slider-base">
                            <div id="ascent-slider"></div>
                        </div>
                                <table>
                                    <tr>
                                        <td id="ascent-slider-min"></td>
                                        <td id="ascent-slider-max"></td>
                                    </tr>
                                </table>
                        {% if form.ascent_min.errors %}
                            {{ form.ascent_min(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.ascent_min.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.ascent_min(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {% if form.ascent_max.errors %}
                            {{ form.ascent_max(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.ascent_max.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.ascent_max(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <div class="form-control-label">Scenery</div>
                        <div class="slider-base">
                            <div id="scenery-slider"></div>
                        </div>
                                <table>
                                    <tr>
                                        <td id="scenery-slider-min"></td>
                                        <td id="scenery-slider-max"></td>
                                    </tr>
                                </table>
                        {% if form.scenery_min.errors %}
                            {{ form.scenery_min(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.scenery_min.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.scenery_min(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {% if form.scenery_max.errors %}
                            {{ form.scenery_max(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.scenery_max.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.scenery_max(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <div class="form-control-label">Brutality</div>
                        <div class="slider-base">
                        <div id="brutality-slider"></div>
                        </div>
                        <table>
                            <tr>
                                <td id="brutality-slider-min"></td>
                                <td id="brutality-slider-max"></td>
                            </tr>
                        </table>
                        {% if form.brutality_min.errors %}
                            {{ form.brutality_min(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.brutality_min.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.brutality_min(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {% if form.brutality_max.errors %}
                            {{ form.brutality_max(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.brutality_max.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.brutality_max(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <div class="form-control-label">Quietness</div>
                        <div class="slider-base">
                        <div id="quietness-slider"></div>
                        </div>
                        <table>
                            <tr>
                                <td id="quietness-slider-min"></td>
                                <td id="quietness-slider-max"></td>
                            </tr>
                        </table>
                        {% if form.quietness_min.errors %}
                            {{ form.quietness_min(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.quietness_min.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.quietness_min(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {% if form.quietness_max.errors %}
                            {{ form.quietness_max(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.quietness_max.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.quietness_max(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {{ form.sort_by.label(class="form-control-label") }}

                        {% if form.sort_by.errors %}
                            {{ form.sort_by(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.sort_by.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.sort_by(class="form-control form-control-sm") }}
                        {% endif %}
                    </div>
                    </fieldset>
                        <div class="form-group">
                            {{form.submit(class="btn btn-primary btn-sm")}}
                        </div>
                </form>
        </div>
        </div>
        <div class="col-md-9">
            {% for route in my_routes.items %}
            <div class="flexiboi">
                <div class="routecontainer">
                    <div class="route-title"><a href="{{ url_for('posts.postPage', post_id=route.post) }}">{{ route.title }}</a></div>
                    <div class="flexinner">
                        <div class="route-location">
                            <table>
                                <tr>
                                    <th>Location</th><td></td>
                                </tr>
                                <tr>
                                    <th>Region</th><td>{{ route.region }}</td>
                                </tr>
                                <tr>
                                    <th>Start</th><td>{{ route.starting_location }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="route-vitals">
                            <table>
                                <tr>
                                    <th>Vitals</th><td></td>
                                </tr>
                                <tr>
                                    <th>Distance</th><td>{{ route.length }} km</td>
                                </tr>
                                <tr>
                                    <th>Ascent</th><td>{{ route.ascent }} m</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="ratingcontainer">
                    <div class="route-title">Ratings</div>
                    <div class="flexiratings">
                        <div><div class="thicker">Scenery:</div> <img src="{{ url_for('static', filename='/icons/' + route.scenery|string + '.png') }}" class="rating-stars" title="{{ route.scenery }}/10"></div>
                        <div><div class="thicker">Brutality:</div> <img src="{{ url_for('static', filename='/icons/' + route.brutality|string + '.png') }}" class="rating-stars" title="{{ route.brutality }}/10"></div>
                        <div><div class="thicker">Quietness:</div> <img src="{{ url_for('static', filename='/icons/' + route.quietness|string + '.png') }}" class="rating-stars" title="{{ route.quietness }}/10"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="d-flex justify-content-center p-3">
        <nav aria-label="Page navigation example">
            <ul class="pagination">
                <li class="page-item {% if not my_routes.has_prev %}disabled{% endif %}"><a class="page-link" href="{{ url_for('routes.routesPage', page=1) }}">First</a></li>
                <li class="page-item {% if not my_routes.has_prev %}disabled{% endif %}"><a class="page-link" href="{{ url_for('routes.routesPage', page=my_routes.prev_num) }}">Previous</a></li>
                {% for page_num in my_routes.iter_pages() %}
                {% if page_num %}
                <li class="page-item {% if my_routes.page == page_num %}active{% endif %}"><a class="page-link" href="{{ url_for('routes.routesPage', page=page_num) }}">{{ page_num }}</a></li>
                {% endif %}
                {% endfor %}
                <li class="page-item {% if not my_routes.has_next %}disabled{% endif %}"><a class="page-link" href="{{ url_for('routes.routesPage', page=my_routes.next_num) }}">Next</a></li>
            </ul>
        </nav>
    </div>
    <script type="module" src="{{ url_for('static', filename='js/sliders.js') }}"></script>
    <script>
        let hideButton = document.getElementById("filter-button");
        let collapseFilters = document.getElementById("collapsefilters");

        window.addEventListener('resize', showHideItems);
        window.addEventListener('load', showHideItems)

        function showHideItems(){
            console.log("window size: " + window.innerWidth)
            if (window.innerWidth > 766){
                if (hideButton.classList.contains("hide-me") == false){
                    hideButton.classList.add("hide-me");
                }
                if (collapseFilters.classList.contains("hide-me")){
                    collapseFilters.classList.remove("hide-me");
                }
            }
            else {
                if (hideButton.classList.contains("hide-me")){
                    hideButton.classList.remove("hide-me");
                }
                if (collapseFilters.classList.contains("hide-me") == false){
                    collapseFilters.classList.add("hide-me");
                }
            }
        }

        function toggleFilters(){
            console.log("Pressed!");
            if(collapseFilters.classList.contains("hide-me")){
                collapseFilters.classList.remove("hide-me");
            }
            else{
                collapseFilters.classList.add("hide-me");
            }
        }
    </script>
{% endblock content %}